# All Results Trajectory Analyzer Configuration
# 
# This configuration loads all available results from CodeRepairRL-results.
# Includes both nano-agent and R2E-Gym scaffold runs.
#
# Usage:
#   uv run python -m src.trajectory_analyzer --config-path conf --config-name all_results_config

output_dir: "./plots/all_results_analysis"

plots:
  # Per-run plots (generated for each run):
  - tool_distribution          # Bar chart of tool usage counts
  - shell_command_distribution # Bar chart of shell commands (grep, cat, etc.)
  - success_rates              # Resolution rates, tool success rates
  - token_analysis             # Token usage analysis
  - error_patterns             # Top error messages (raw first 5 words)
  - failed_tool_calls          # Most common failing tool calls with arguments
  - error_analysis             # Comprehensive error analysis (categories, rates, tools)
  # Multi-run plots (when 2+ runs):
  - comparison                 # Cross-run comparison grid
  - transfer_analysis          # Transfer learning impact (basic summary)
  - transfer_mcnemar           # Instance-level transfer (McNemar contingency + stats)
  - transfer_error_modes       # Error mode comparison between scaffolds
  - transfer_vocabulary        # Tool vocabulary alignment and hallucinations
  - transfer_error_patterns    # Raw error message pattern changes
  - variance_vs_difficulty     # Variance analysis vs difficulty metrics (requires instances)
  - deep_variance              # Deep variance analysis: mean Â± stddev for all metrics across runs
  - trajectory_dynamics        # Localization accuracy, phases, error recovery
  - sequence_patterns          # Tool call sequence analysis (bigrams, starts, ends)
  - failure_taxonomy           # Categorization of why trajectories fail

# Optional: Load SWE-bench instances for difficulty metrics
# This enables variance analysis correlating difficulty (#files, #lines changed)
# with resolution rates and variance across runs
instances:
  # HuggingFace dataset name (e.g., 'SWE-bench/SWE-bench') or path to JSON/JSONL file
  source: SWE-bench/SWE-bench_Verified  # Set to dataset name or file path to enable
  split: test   # Optional: dataset split (e.g., 'test', 'train'). If null, uses default.

# Model to trained scaffold mapping
model_to_trained_scaffold:
  "agentica-org/DeepSWE-Preview": "r2e-gym"
  "ASSERT-KTH/Qwen3-32B-Nano-SWE-Gym-SFT-Lora": "nano-agent"
  "Qwen/Qwen3-32B": null  # Base model, not trained on specific scaffold
  "Qwen/Qwen3-14B": null
  "Qwen/Qwen3-8B": null

runs:
  # ===== NANO-AGENT SCAFFOLD RUNS =====
  
  # DeepSWE on nano-agent scaffold
  - name: "deepswe-nano-agent"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-agentica-org_DeepSWE-Preview/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-agentica-org_DeepSWE-Preview/nano-agent-hosted_vllm__agentica-org__DeepSWE-Preview.deepswe_32b__nano__500_tool_cals.json"
    base_model: "agentica-org/DeepSWE-Preview"
    scaffold: "nano-agent"
    lora_adapter: null

  # Qwen3-32B SFT LoRA on nano-agent scaffold
  - name: "qwen32b-sftlora-nano-agent"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-ASSERT-KTH_Qwen3-32B-Nano-SWE-Gym-SFT-Lora/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-ASSERT-KTH_Qwen3-32B-Nano-SWE-Gym-SFT-Lora/nano-agent-hosted_vllm__ASSERT-KTH__Qwen3-32B-Nano-SWE-Gym-SFT-Lora.nanosftlora_32b__nano.json"
    base_model: "ASSERT-KTH/Qwen3-32B-Nano-SWE-Gym-SFT-Lora"
    scaffold: "nano-agent"
    lora_adapter: "Qwen3-32B-Nano-SWE-Gym-SFT-Lora"

  # Qwen3-32B base on nano-agent scaffold (10 runs)
  - name: "qwen32b-nano-agent-run0"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_0/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_0/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_0__xjoahx74.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run1"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_1/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_1/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_1__6syxvqva.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run2"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_2/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_2/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_2__6s17jze0.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run3"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_3/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_3/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_3__x55a0mtm.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run4"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_4/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_4/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_4__xzic6w58.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run5"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_5/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_5/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_5__uev8yzz4.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run6"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_6/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_6/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_6__u1aqighg.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run7"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_7/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_7/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_7__5bmcf95l.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run8"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_8/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_8/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_8__2n2j4p7v.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  - name: "qwen32b-nano-agent-run9"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_9/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-32B/run_9/nano-agent-hosted_vllm__Qwen__Qwen3-32B.nano-agent-Qwen_Qwen3-32B__run_9__r9xyfb8z.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "nano-agent"
    lora_adapter: null

  # Qwen3-14B base on nano-agent scaffold
  - name: "qwen14b-nano-agent"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-14B/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-14B/nano-agent-hosted_vllm__Qwen__Qwen3-14B.qwen_14b__nano.json"
    base_model: "Qwen/Qwen3-14B"
    scaffold: "nano-agent"
    lora_adapter: null

  # Qwen3-8B base on nano-agent scaffold
  - name: "qwen8b-nano-agent"
    format: "nano_agent"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-8B/detailed_predictions.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/nano-agent-Qwen_Qwen3-8B/nano-agent-hosted_vllm__Qwen__Qwen3-8B.qwen_8b__nano.json"
    base_model: "Qwen/Qwen3-8B"
    scaffold: "nano-agent"
    lora_adapter: null

  # ===== R2E-GYM SCAFFOLD RUNS =====
  
  # DeepSWE on R2E-Gym scaffold (its training scaffold) - temp 1.0 run 1
  - name: "deepswe-r2e-gym-temp1-run1"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_1_run_1.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_1_run_1.deepswe_32b__r2egym.json"
    base_model: "agentica-org/DeepSWE-Preview"
    scaffold: "r2e-gym"
    lora_adapter: null

  # DeepSWE on R2E-Gym scaffold - temp 1.0 run 2
  - name: "deepswe-r2e-gym-temp1-run2"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_1_run_2.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_1_run_2.deepswe_32b__r2egym__run2.json"
    base_model: "agentica-org/DeepSWE-Preview"
    scaffold: "r2e-gym"
    lora_adapter: null

  # DeepSWE on R2E-Gym scaffold - temp 1.0 run 3
  - name: "deepswe-r2e-gym-temp1-run3"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_1_run_3.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_1_run_3.deepswe_32b__r2egym__run3.json"
    base_model: "agentica-org/DeepSWE-Preview"
    scaffold: "r2e-gym"
    lora_adapter: null

  # DeepSWE on R2E-Gym scaffold - temp 0.2 run 1
  - name: "deepswe-r2e-gym-temp0.2-run1"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_0.2_run_1.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_deepswe32b/deepswe_32b_agent_swebv_eval_temp_0.2_run_1.deepswe_32b__r2egym__temp_0.2_run_1.json"
    base_model: "agentica-org/DeepSWE-Preview"
    scaffold: "r2e-gym"
    lora_adapter: null

  # Qwen3-32B SFT LoRA on R2E-Gym scaffold
  - name: "qwen32b-sftlora-r2e-gym"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_nanosftlora32b/nanosftlora_32b_agent_swebv_eval_temp_1_run_1.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_nanosftlora32b/nanosftlora_32b_agent_swebv_eval_temp_1_run_1.nanosftlora_32b__r2egym__run_1.json"
    base_model: "ASSERT-KTH/Qwen3-32B-Nano-SWE-Gym-SFT-Lora"
    scaffold: "r2e-gym"
    lora_adapter: "Qwen3-32B-Nano-SWE-Gym-SFT-Lora"

  # Qwen3-32B base on R2E-Gym scaffold - temp 1.0 run 1
  - name: "qwen32b-r2e-gym-temp1-run1"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_1_run_1.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_1_run_1.qwen_32b__r2egym.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "r2e-gym"
    lora_adapter: null

  # Qwen3-32B base on R2E-Gym scaffold - temp 1.0 run 2
  - name: "qwen32b-r2e-gym-temp1-run2"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_1_run_2.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_1_run_2.qwen_32b__r2egym__run2.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "r2e-gym"
    lora_adapter: null

  # Qwen3-32B base on R2E-Gym scaffold - temp 1.0 run 3
  - name: "qwen32b-r2e-gym-temp1-run3"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_1_run_3.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_1_run_3.qwen_32b__r2egym__run3.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "r2e-gym"
    lora_adapter: null

  # Qwen3-32B base on R2E-Gym scaffold - temp 0.2 run 1
  - name: "qwen32b-r2e-gym-temp0.2-run1"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_0.2_run_1.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_qwen32b/qwen3_32b_agent_swebv_eval_temp_0.2_run_1.qwen_32b__r2egym__temp_0.2_run_1.json"
    base_model: "Qwen/Qwen3-32B"
    scaffold: "r2e-gym"
    lora_adapter: null

  # Qwen3-8B base on R2E-Gym scaffold
  - name: "qwen8b-r2e-gym"
    format: "r2e_gym"
    trajectories: "/home/andre/Repos/CodeRepairRL-results/traj_qwen8b/qwen_8b_agent_swebv_eval_temp_1_run_1.jsonl"
    results: "/home/andre/Repos/CodeRepairRL-results/traj_qwen8b/qwen_8b_agent_swebv_eval_temp_1_run_1.qwen_8b__r2egym__run_1.json"
    base_model: "Qwen/Qwen3-8B"
    scaffold: "r2e-gym"
    lora_adapter: null

hydra:
  job:
    chdir: false

