Bootstrap: docker
From: vllm/vllm-openai:v0.8.5.post1

%environment
    export SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt
    export HF_HOME=$PROJECT_DIR/.hf
    export TRANSFORMERS_CACHE=$PROJECT_DIR/.cache/huggingface/transformers
    export HF_DATASETS_CACHE=$PROJECT_DIR/.cache/huggingface/datasets

%files
    pyproject.toml
    src/

%post
    apt-get update && \
    apt-get install -y --no-install-recommends git curl ca-certificates ripgrep
    
    pip install --upgrade pip
    pip install .
    
    pip install --no-build-isolation flash-attn==2.7.3
    pip install --no-build-isolation flashinfer-python