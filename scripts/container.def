Bootstrap: docker
From: python:3.11-slim

%files
    # Copy project files into the container
    pyproject.toml /opt/ttc/pyproject.toml
    uv.lock /opt/ttc/uv.lock
    .python-version /opt/ttc/.python-version

%post
    # Install system dependencies
    apt-get update && apt-get install -y build-essential curl git && rm -rf /var/lib/apt/lists/*
    
    # Install uv
    curl -LsSf https://astral.sh/uv/install.sh | sh
    
    # Verify uv installation (this check only affects the build-time shell)
    which uv || echo "uv not found in PATH"
    
    # Install dependencies using uv
    cd /opt/ttc
    /root/.local/bin/uv sync

%environment
    # Ensure uv is in the PATH at runtime
    export PATH="/root/.local/bin:$PATH"